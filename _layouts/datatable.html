{% include default.html %}

{% if page.datatable == "awards" %}
    <script>
     var awardsData =  {{ site.data.awards | jsonify }} ;
     var awardsTable = $("#site_data_awards").DataTable({
            "paging": false,
            "info": false,
            "searching": true,
            "ordering": true,
            "columns": [
                { data: "Award" },      // 0
                { data: "2023" },       // 1
                { data: "2022" },       // 2
                { data: "2021" },       // 3
                { data: "2020" },       // 4
                { data: "2019" },       // 5
                { data: "2018" },       // 6
                { data: "2017" },       // 7
                { data: "2016" },       // 8
                { data: "2015" },       // 9
                { data: "2014" },       // 10
                { data: "2013" },       // 11
            ],
        });
        awardsTable.rows.add(awardsData).draw();
    </script>
{% elsif page.datatable == "committee" %}
    <script>
        // committee page this code is more basic as its a standard markdown table
        $(".committee").DataTable({
            "paging": false,
            "info": false,
            "searching": false,
            "ordering": false,
            "order": []
        });
    </script>
{% elsif page.datatable == "fixtures" %}
    <script>
        var cutoffDate = new Date();
        cutoffDate.setFullYear(cutoffDate.getFullYear(), cutoffDate.getMonth() - 1); // display events from 1 month ago forwards
        var fixturesDataAll =  {{ site.data.fixtures | jsonify }} ;
        var fixturesData = fixturesDataAll.filter(d => Date.parse(d.date_sort) > cutoffDate);
        var fixturesTable = $("#site_data_fixtures").DataTable({
            "paging": false,
            "info": true,
            "columns": [
                { data: "Date", width: "0px" },             // 0
                { data: "date_sort", width: "0px" },        // 1
                { data: "Race", width: "100%"},             // 2
                { data: "Distance", width: "0px" },         // 3
                { data: "distance_sort", width: "0px" },    // 4
                { data: "Terrain", width: "0px" }           // 5
            ],
            columnDefs: [
                { // hidden columns
                    "visible": false,
                    "targets": [1, 4]  // date_sort, distance_sort
                },
                { // non-searchable columns
                    "searchable": false,
                    "targets": [1, 4] // date_sort, Series, distance_sort
                },
                { // non-sortable columns
                    "orderable": false,
                    "targets": [2] // Race
                },
                { // column sort remapping
                    targets: [0], // Date
                    orderData: [1] // date_sort
                },
                { // column sort remapping
                    targets: [3], // Distance
                    orderData: [4] // distance_sort
                },
            ],
        });
        fixturesTable.rows.add(fixturesData).draw();
    </script>
{% elsif page.datatable == "records" %}
    <script>
        var recordsData =  {{ site.data.records | jsonify }} ;
        recordsData = recordsData.filter(f => f.date_sort != "99999999") // ignore empty records
    </script>
    {% if page.datatype == "road" %}
        <script>
            recordsData = recordsData.filter(f => f.type_sort == "1") // road only
        </script>
    {% elsif page.datatype == "multi" %}
        <script>
            recordsData = recordsData.filter(f => f.type_sort == "2") // multi-terrain only
        </script>
    {% elsif page.datatype == "track" %}
        <script>
            recordsData = recordsData.filter(f => f.type_sort == "3") // track only
        </script>
    {% elsif page.datatype == "field" %}
        <script>
            recordsData = recordsData.filter(f => f.type_sort == "4") // field events only
        </script>
    {% elsif page.datatype == "parkrun" %}
    <script>
        recordsData = recordsData.filter(f => f.type_sort == "5") // parkrun only
    </script>
    {% endif %}
    {% if page.datagender == "men" %}
    <script>
        recordsData = recordsData.filter(f => f.gender_search == "xy") // men only
    </script>
    {% elsif page.datagender == "women" %}
    <script>
        recordsData = recordsData.filter(f => f.gender_search == "xx") // women only
    </script>
    {% endif %}
    <script>
        var recordsTable = $("#site_data_records").DataTable({
            "paging": true,
            "info": true,
            "language": {
                "emptyTable": "No records",
                "zeroRecords": "No records"
            },
            "columns": [
                { data: "Type" },               // 0
                { data: "type_sort" },          // 1
                { data: "Gender" },             // 2
                { data: "gender_search" },      // 3
                { data: "Distance" },           // 4
                { data: "distance_m_sort" },    // 5
                { data: "Age Group" },          // 6
                { data: "age_sort" },           // 7
                { data: "Holder" },             // 8
                { data: "Time" },               // 9
                { data: "time_secs_sort" },     // 10
                { data: "Venue" },              // 11
                { data: "Date" },               // 12
                { data: "date_sort" }           // 13
            ],
            "pageLength": 25, // initial page length
            "order": [[4, 'asc'], [6, 'asc']], // initial sort - Distance, Age Group
            columnDefs: [
                { // hidden columns
                    "visible": false,
                    "targets": [0, 1, 2, 3, 5, 7, 10, 13]  // Type, type_sort, Gender, gender_search, distance_m_sort, age_sort, time_secs_sort, date_sort
                },
                { // non-searchable columns
                    "searchable": false,
                    "targets": [0, 1, 2, 3, 5, 7, 10, 13]  // Type, type_sort, Gender, gender_search, distance_m_sort, age_sort, time_secs_sort, date_sort
                },
                { // non-sortable columns
                    "orderable": false,
                    "targets": [8, 11] // Holder, Venue
                },
                { // column sort remapping
                    targets: [4], // Distance
                    orderData: [5] // distance_m_sort
                },
                { // column sort remapping
                    targets: [6], // Age Group
                    orderData: [7] // age_sort
                },
                { // column sort remapping
                    targets: [9], // Time
                    orderData: [10] // time_secs_sort
                },
                { // column sort remapping
                    targets: [12], // Date
                    orderData: [13] // date_sort
                },
                // column widths 0px => width to fit data
                { "width": "0px", "targets": 4 },   // Distance
                { "width": "0px", "targets": 6 },   // Age Group
                { "width": "0px", "targets": 9 },   // Time
                { "width": "0px", "targets": 12 },  // Date
            ],
        });
    </script>
    {% if page.datatype == "field" %}
    <script>
        $(recordsTable.column(4).header()).text('Event'); // field - rename Distance column to Event
    </script>
    {% elsif page.datatype == "parkrun" %}
        <script>
            recordsTable.column(4).visible(false); // parkrun - hide Distance column, they're all 5k
        </script>
    {% endif %}
    <script>
        recordsTable.rows.add(recordsData).draw();
    </script>
{% elsif page.datatable == "cwr" %}
    <script>
        var cwrData =  {{ site.data.cwr | jsonify }} ;
        var cwrTable = $("#site_data_cwr").DataTable({
            "paging": true,
            "info": true,
            "columns": [
                { data: "Leg" },                // 0
                { data: "leg_search" },         // 1
                { data: "Team" },               // 2
                { data: "Category" },           // 3
                { data: "Name" },               // 4
                { data: "name_sort" },          // 5
                { data: "Time" },               // 6
                { data: "time_secs_sort" },     // 7
                { data: "Distance" },           // 8
                { data: "Start" },              // 9
                { data: "Finish" },             // 10
                { data: "Date" },               // 11
                { data: "date_sort" },          // 12
            ],
            "pageLength": 25, // initial page length
            "order": [[11, 'desc'], [0, 'asc'], [6, 'asc']], // initial sort - Date, Leg, Time
            columnDefs: [
                { // hidden columns
                    "visible": false,
                    "targets": [1, 5, 7, 12]  // leg_search, name_sort, time_secs_sort, date_sort
                },
                { // non-searchable columns
                    "searchable": false,
                    "targets": [0, 5, 7, 12]  // Leg, name_sort, time_secs_sort, date_sort
                },
                { // non-sortable columns
                    "orderable": false,
                    "targets": [2, 3, 9, 10] // Team, Category, Start, Finish
                },
                { // column sort remapping
                    targets: [4], // Name
                    orderData: [5] // name_sort
                },
                { // column sort remapping
                    targets: [6], // Time
                    orderData: [7] // time_sort
                },
                { // column sort remapping
                    targets: [11], // Date
                    orderData: [12] // date_sort
                },
                { "width": "0px", "targets": 0 },   // Leg
                { "width": "0px", "targets": 3 },   // Category
                { "width": "0px", "targets": 6 },   // Time
                { "width": "0px", "targets": 8 },   // Distance
                { "width": "0px", "targets": 11 },  // Date
            ],
        });
        cwrTable.rows.add(cwrData).draw();
    </script>
    {% elsif page.datatable == "roadraceseries" %}
    <script>
        var roadRaceSeriesData =  {{ site.data.roadraceseries | jsonify }} ;

        mensOpenData = roadRaceSeriesData.filter(f => f.Category == "MO");
        if(mensOpenData.length == 0) {
            $("#site_data_roadraceseries_mensopen").hide();
        }else{
        var mensOpenRoadRaceSeriesTable = $("#site_data_roadraceseries_mensopen").DataTable({
            "paging": true,
            "info": true,
            "columns": [
                { data: "Name" },            // 0
                { data: "bourton10k" },      // 1
                { data: "bristol" },         // 2
                { data: "berkeley" },        // 3
                { data: "bourton1mile" },    // 4
                { data: "cleeve" },          // 5
                { data: "midsummer" },       // 6
                { data: "haresfield" },      // 7
                { data: "bugatti" },         // 8
                { data: "cheltenhamhalf" },  // 9
                { data: "angels" },          // 10
                { data: "stroudhalf" },      // 11
                { data: "glosxc" },          // 12
                { data: "total" },           // 13
                { data: "rank" },            // 14
                { data: "average" },         // 15
            ],
            "pageLength": 10, // initial page lengths
            "order": [[14, 'asc'], [15, 'asc'], [13, 'asc']], // initial sort - rank, average, total
        });
        mensOpenRoadRaceSeriesTable.rows.add(mensOpenData).draw();
    }

        womensOpenData = roadRaceSeriesData.filter(f => f.Category == "WO");
        if(womensOpenData.length == 0) {
            $("#site_data_roadraceseries_womensopen").hide();
        }else{
        var womensOpenRoadRaceSeriesTable = $("#site_data_roadraceseries_womensopen").DataTable({
            "paging": true,
            "info": true,
            "columns": [
                { data: "Name" },            // 0
                { data: "bourton10k" },      // 1
                { data: "bristol" },         // 2
                { data: "berkeley" },        // 3
                { data: "bourton1mile" },    // 4
                { data: "cleeve" },          // 5
                { data: "midsummer" },       // 6
                { data: "haresfield" },      // 7
                { data: "bugatti" },         // 8
                { data: "cheltenhamhalf" },  // 9
                { data: "angels" },          // 10
                { data: "stroudhalf" },      // 11
                { data: "glosxc" },          // 12
                { data: "total" },           // 13
                { data: "rank" },            // 14
                { data: "average" },         // 15
            ],
            "pageLength": 10, // initial page lengths
            "order": [[14, 'asc'], [15, 'asc'], [13, 'asc']], // initial sort - rank, average, total
        });
        womensOpenRoadRaceSeriesTable.rows.add(womensOpenData).draw();
    }

        mv40Data = roadRaceSeriesData.filter(f => f.Category == "MV40");
        if(mv40Data.length == 0) {
            $("#site_data_roadraceseries_mv40").hide();
        }
        lv40Data = roadRaceSeriesData.filter(f => f.Category == "LV40");
        if(lv40Data.length == 0) {
            $("#site_data_roadraceseries_lv40").hide();
        }
        mv50Data = roadRaceSeriesData.filter(f => f.Category == "MV50");
        if(mv50Data.length == 0) {
            $("#site_data_roadraceseries_mv50").hide();
        }
        lv50Data = roadRaceSeriesData.filter(f => f.Category == "LV50");
        if(lv50Data.length == 0) {
            $("#site_data_roadraceseries_lv50").hide();
        }
        mv60Data = roadRaceSeriesData.filter(f => f.Category == "MV60");
        if(mv60Data.length == 0) {
            $("#site_data_roadraceseries_mv60").hide();
        }
        lv60Data = roadRaceSeriesData.filter(f => f.Category == "LV60");
        if(lv60Data.length == 0) {
            $("#site_data_roadraceseries_lv60").hide();
        }
        mv70Data = roadRaceSeriesData.filter(f => f.Category == "MV70");
        if(mv70Data.length == 0) {
            $("#site_data_roadraceseries_mv70").hide();
        }
    </script>
{% endif %}
